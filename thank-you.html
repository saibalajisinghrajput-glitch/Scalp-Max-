<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thank You - Scalp Max</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%); min-height: 100vh; display: flex; flex-direction: column; }
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 12px; min-width: 300px; max-width: 450px; animation: slideInRight 0.4s ease-out; border-left: 4px solid; }
        .toast.success { border-color: #4CAF50; }
        .toast.error { border-color: #f44336; }
        .toast.warning { border-color: #ff9800; }
        .toast.info { border-color: #2196F3; }
        .toast-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }
        .toast.success .toast-icon { background: #e8f5e9; color: #4CAF50; }
        .toast.error .toast-icon { background: #ffebee; color: #f44336; }
        .toast.warning .toast-icon { background: #fff3e0; color: #ff9800; }
        .toast.info .toast-icon { background: #e3f2fd; color: #2196F3; }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; font-size: 1rem; color: #333; margin-bottom: 2px; }
        .toast-message { font-size: 0.9rem; color: #666; }
        .toast-close { background: none; border: none; font-size: 1.2rem; color: #999; cursor: pointer; padding: 5px; transition: color 0.3s; }
        .toast-close:hover { color: #333; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .thank-header { background: white; padding: 20px 40px; box-shadow: 0 2px 20px rgba(0,0,0,0.08); display: flex; justify-content: space-between; align-items: center; }
        .thank-header .logo { font-size: 1.8rem; font-weight: 700; color: var(--primary-color, #2d5a27); display: flex; align-items: center; gap: 10px; }
        .thank-header .logo i { color: #4CAF50; }
        .step-indicator { display: flex; gap: 10px; }
        .step { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: #999; background: #f0f0f0; }
        .step.active { background: var(--primary-color, #2d5a27); color: white; }
        .step.completed { background: #4CAF50; color: white; }
        .step i { font-size: 0.8rem; }
        .thank-main { flex: 1; display: flex; justify-content: center; align-items: center; padding: 60px 20px; }
        .thank-card { background: white; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); max-width: 700px; width: 100%; overflow: hidden; }
        .success-header { background: linear-gradient(135deg, #2d5a27 0%, #4a8c42 100%); color: white; padding: 50px 40px; text-align: center; }
        .success-icon { width: 100px; height: 100px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; }
        .success-icon i { font-size: 3rem; color: #4CAF50; }
        .success-header h1 { font-size: 2rem; margin-bottom: 10px; }
        .success-header p { font-size: 1.1rem; opacity: 0.9; }
        .order-details { padding: 40px; }
        .order-id-box { background: #f8f9fa; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 30px; }
        .order-id-box label { font-size: 0.9rem; color: #666; margin-bottom: 5px; display: block; }
        .order-id-box .order-number { font-size: 1.5rem; font-weight: 700; color: var(--primary-color, #2d5a27); letter-spacing: 2px; }
        .status-section { display: flex; justify-content: center; margin-bottom: 35px; }
        .status-badge { display: inline-flex; align-items: center; gap: 10px; padding: 12px 24px; border-radius: 30px; font-weight: 600; font-size: 1rem; }
        .status-badge.pending { background: #fff3cd; color: #856404; }
        .status-badge.processing { background: #cce5ff; color: #004085; }
        .status-badge.confirmed { background: #d4edda; color: #155724; }
        .order-summary-box { background: #f8f9fa; border-radius: 16px; padding: 25px; margin-bottom: 30px; }
        .order-summary-box h3 { font-size: 1.1rem; color: #333; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e9ecef; }
        .summary-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e9ecef; }
        .summary-row:last-child { border-bottom: none; }
        .summary-row.total { margin-top: 10px; padding-top: 15px; border-top: 2px solid #dee2e6; font-weight: 700; font-size: 1.1rem; }
        .summary-row.total span:last-child { color: var(--primary-color, #2d5a27); font-size: 1.3rem; }
        .order-timeline { margin-bottom: 30px; }
        .order-timeline h3 { font-size: 1.1rem; color: #333; margin-bottom: 20px; }
        .timeline { display: flex; justify-content: space-between; position: relative; }
        .timeline::before { content: ''; position: absolute; top: 15px; left: 30px; right: 30px; height: 3px; background: #e9ecef; }
        .timeline-item { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; flex: 1; }
        .timeline-icon { width: 35px; height: 35px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        .timeline-icon.active { background: var(--primary-color, #2d5a27); color: white; }
        .timeline-icon.completed { background: #4CAF50; color: white; }
        .timeline-icon i { font-size: 0.9rem; }
        .timeline-label { font-size: 0.75rem; color: #666; text-align: center; }
        .timeline-item.active .timeline-label { color: var(--primary-color, #2d5a27); font-weight: 600; }
        .qr-section { background: #fff8e6; border: 2px solid #ffc107; border-radius: 16px; padding: 25px; margin-bottom: 30px; text-align: center; }
        .qr-section h4 { color: #856404; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.1rem; }
        .qr-container { background: white; padding: 20px; border-radius: 12px; display: inline-block; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .qr-container img { width: 180px; height: 180px; display: block; }
        .qr-amount { font-size: 1.8rem; font-weight: 700; color: var(--primary-color, #2d5a27); margin: 15px 0; }
        .qr-upi-id { font-size: 1rem; color: #666; font-family: monospace; background: #f5f5f5; padding: 8px 16px; border-radius: 8px; display: inline-block; }
        .qr-instructions { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #ddd; font-size: 0.9rem; color: #666; text-align: left; }
        .qr-instructions ol { margin-top: 10px; padding-left: 20px; }
        .qr-instructions li { margin-bottom: 8px; }
        .cod-section { background: #d4edda; border: 2px solid #28a745; border-radius: 16px; padding: 25px; margin-bottom: 30px; text-align: center; }
        .cod-section h4 { color: #155724; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.1rem; }
        .cod-section p { color: #666; font-size: 0.95rem; margin-bottom: 10px; }
        .cod-amount { font-size: 1.5rem; font-weight: 700; color: #155724; }
        .action-buttons { display: flex; flex-direction: column; gap: 15px; }
        .btn-primary { background: linear-gradient(135deg, #2d5a27 0%, #4a8c42 100%); color: white; border: none; padding: 18px 30px; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(45, 90, 39, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(45, 90, 39, 0.4); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-secondary { background: white; color: var(--primary-color, #2d5a27); border: 2px solid var(--primary-color, #2d5a27); padding: 16px 30px; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .btn-secondary:hover { background: var(--primary-color, #2d5a27); color: white; }
        .confirmation-message { text-align: center; padding: 30px; }
        .confirmation-message .success-animation { width: 80px; height: 80px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; }
        .confirmation-message .success-animation i { color: white; font-size: 2.5rem; }
        .confirmation-message h3 { color: #155724; font-size: 1.5rem; margin-bottom: 10px; }
        .confirmation-message p { color: #666; font-size: 1rem; }
        .thank-footer { background: white; padding: 25px; text-align: center; border-top: 1px solid #eee; }
        .thank-footer p { color: #666; font-size: 0.9rem; }
        .confetti { position: fixed; width: 10px; height: 10px; background: #4CAF50; animation: confettiFall 3s ease-out forwards; pointer-events: none; }
        @keyframes confettiFall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .hidden { display: none !important; }
        @media (max-width: 600px) { .thank-header { flex-direction: column; gap: 15px; padding: 15px 20px; } .step-indicator { width: 100%; justify-content: center; } .step span { display: none; } .success-header { padding: 40px 20px; } .order-details { padding: 25px; } .timeline-label { font-size: 0.65rem; } .qr-container img { width: 150px; height: 150px; } .toast { min-width: auto; max-width: calc(100vw - 40px); } }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <header class="thank-header">
        <a href="index.html" class="logo"><i class="fas fa-leaf"></i> Scalp Max</a>
        <div class="step-indicator">
            <div class="step completed"><i class="fas fa-check"></i><span>Cart</span></div>
            <div class="step completed"><i class="fas fa-check"></i><span>Checkout</span></div>
            <div class="step active"><i class="fas fa-check"></i><span>Complete</span></div>
        </div>
    </header>
    <main class="thank-main">
        <div class="thank-card">
            <div class="success-header">
                <div class="success-icon"><i class="fas fa-check"></i></div>
                <h1>Thank You!</h1>
                <p>Your order has been placed successfully</p>
            </div>
            <div class="order-details">
                <div class="order-id-box"><label>Order Number</label><div class="order-number" id="orderId">Loading...</div></div>
                <div class="status-section"><div class="status-badge pending" id="statusBadge"><i class="fas fa-clock"></i><span>Payment Pending</span></div></div>
                <div class="qr-section" id="qrSection">
                    <h4><i class="fas fa-qrcode"></i> Scan to Pay ₹499</h4>
                    <div class="qr-container"><img id="qrImage" src="" alt="UPI QR Code"></div>
                    <div class="qr-amount">₹499</div>
                    <p style="color: #28a745; font-size: 0.95rem; margin-bottom: 10px;"><i class="fas fa-check-circle"></i> Amount will be automatically pre-filled</p>
                    <p style="color: #856404; font-size: 0.9rem; margin-bottom: 15px;"><i class="fab fa-google-pay"></i> <i class="fab fa-whatsapp"></i> Works with Google Pay, PhonePe, BHIM, Paytm</p>
                    <p style="color: #666; font-size: 0.85rem; margin-bottom: 10px; font-style: italic;">When scanned with Google Pay, PhonePe, BHIM, or Paytm, ₹499 is automatically filled</p>
                    <div class="qr-upi-id">saibalajisinghrajput@oksbi</div>
                    <div class="qr-instructions">
                        <p style="color: #856404; margin-bottom: 10px;"><i class="fas fa-mobile-alt"></i> Just scan and enter PIN to pay</p>
                        <strong>How to pay:</strong>
                        <ol>
                            <li>Open any UPI app (PhonePe, GPay, Paytm)</li>
                            <li>Scan the QR code above</li>
                            <li>Amount ₹499 will be automatically filled</li>
                            <li>Enter your PIN to complete payment</li>
                            <li>Click "I Have Completed Payment" below</li>
                        </ol>
                    </div>
                </div>
                <div class="cod-section" id="codSection" style="display: none;">
                    <h4><i class="fas fa-truck"></i> Cash on Delivery</h4>
                    <p>You will pay <span class="cod-amount">₹499</span> when you receive your package.</p>
                    <p>Our delivery partner will contact you before delivery.</p>
                </div>
                <div class="order-summary-box">
                    <h3><i class="fas fa-box-open"></i> Order Summary</h3>
                    <div class="summary-row"><span>SCALP MAX Anti Dandruff Shampoo</span><span>₹499</span></div>
                    <div class="summary-row"><span>Quantity</span><span>1</span></div>
                    <div class="summary-row"><span>Shipping</span><span style="color: #4CAF50;">FREE</span></div>
                    <div class="summary-row total"><span>Total</span><span>₹499</span></div>
                </div>
                <div class="order-timeline">
                    <h3><i class="fas fa-shipping-fast"></i> Order Tracking</h3>
                    <div class="timeline">
                        <div class="timeline-item completed"><div class="timeline-icon completed"><i class="fas fa-check"></i></div><span class="timeline-label">Order Placed</span></div>
                        <div class="timeline-item" id="timelineProcessing"><div class="timeline-icon active"><i class="fas fa-cog"></i></div><span class="timeline-label">Processing</span></div>
                        <div class="timeline-item" id="timelineShipped"><div class="timeline-icon"><i class="fas fa-truck"></i></div><span class="timeline-label">Shipped</span></div>
                        <div class="timeline-item" id="timelineDelivered"><div class="timeline-icon"><i class="fas fa-home"></i></div><span class="timeline-label">Delivered</span></div>
                    </div>
                </div>
                <div class="action-buttons" id="actionButtons">
                    <button id="confirmPayment" class="btn-primary"><i class="fas fa-check-circle"></i>I Have Completed Payment</button>
                    <a href="index.html" class="btn-secondary"><i class="fas fa-arrow-left"></i>Continue Shopping</a>
                </div>
                <div class="confirmation-message hidden" id="confirmationMessage">
                    <div class="success-animation"><i class="fas fa-check"></i></div>
                    <h3>Payment Confirmed!</h3>
                    <p>Thank you! Your order is now being processed.</p>
                    <p style="margin-top: 15px; color: #888;">You will receive a confirmation SMS shortly.</p>
                </div>
            </div>
        </div>
    </main>
    <footer class="thank-footer"><p>Need help? Contact us at <strong>support@scalpmax.com</strong></p><p style="margin-top: 15px; font-size: 0.8rem;">&copy; 2024 Scalp Max. All rights reserved.</p></footer>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script>
        var currentOrderId = null;
        var currentPaymentMethod = null;
        function showToast(type, title, message, duration) {
            var container = document.getElementById('toast-container');
            var toast = document.createElement('div');
            toast.className = 'toast ' + type;
            var iconMap = { success: 'fas fa-check-circle', error: 'fas fa-times-circle', warning: 'fas fa-exclamation-triangle', info: 'fas fa-info-circle' };
            toast.innerHTML = '<div class="toast-icon"><i class="' + iconMap[type] + '"></i></div><div class="toast-content"><div class="toast-title">' + title + '</div><div class="toast-message">' + message + '</div></div><button class="toast-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>';
            container.appendChild(toast);
            setTimeout(function() { if (toast.parentElement) { toast.style.animation = 'slideOutRight 0.4s ease-in forwards'; setTimeout(function() { if (toast.parentElement) toast.remove(); }, 400); } }, duration || 5000);
        }
        function createConfetti() {
            var colors = ['#4CAF50', '#2d5a27', '#8BC34A', '#FFC107', '#fff'];
            for (var i = 0; i < 50; i++) {
                var confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);
                setTimeout(function() { confetti.remove(); }, 5000);
            }
        }
        function generateUPIQR(upiId, amount, note) {
            var payeeName = 'Scalp Max';
            var encodedNote = encodeURIComponent(note);
            var encodedName = encodeURIComponent(payeeName);
            return 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=upi://pay?pa=' + upiId + '&pn=' + encodedName + '&am=' + amount + '&cu=INR&tn=' + encodedNote;
        }
        document.addEventListener('DOMContentLoaded', async function() {
            currentOrderId = localStorage.getItem('lastOrderId');
            currentPaymentMethod = localStorage.getItem('paymentMethod');
            if (!currentOrderId) { document.getElementById('orderId').textContent = 'Not found'; showToast('error', 'Order Not Found', 'Could not find your order. Please try again.'); return; }
            document.getElementById('orderId').textContent = currentOrderId;
            var upiId = 'saibalajisinghrajput@oksbi';
            var amount = '499';
            var note = 'Scalp Max Order ' + currentOrderId;
            var qrUrl = generateUPIQR(upiId, amount, note);
            document.getElementById('qrImage').src = qrUrl;
            if (currentPaymentMethod === 'COD') {
                document.getElementById('qrSection').style.display = 'none';
                document.getElementById('codSection').style.display = 'block';
                document.getElementById('confirmPayment').innerHTML = '<i class="fas fa-check"></i> Order Confirmed';
                document.getElementById('confirmPayment').disabled = true;
                document.getElementById('statusBadge').innerHTML = '<i class="fas fa-box"></i> <span>Processing</span>';
                document.getElementById('statusBadge').className = 'status-badge processing';
                var tp = document.getElementById('timelineProcessing').querySelector('.timeline-icon');
                tp.className = 'timeline-icon completed';
                tp.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(createConfetti, 500);
                showToast('success', 'Order Placed!', 'Your order has been confirmed. Pay when you receive the package.');
            } else if (currentPaymentMethod === 'WHATSAPP') {
                document.getElementById('qrSection').style.display = 'none';
                document.getElementById('codSection').style.display = 'none';
                document.getElementById('confirmPayment').innerHTML = '<i class="fas fa-check"></i> Order Confirmed';
                document.getElementById('confirmPayment').disabled = true;
                document.getElementById('statusBadge').innerHTML = '<i class="fas fa-box"></i> <span>Processing</span>';
                document.getElementById('statusBadge').className = 'status-badge processing';
                var tp2 = document.getElementById('timelineProcessing').querySelector('.timeline-icon');
                tp2.className = 'timeline-icon completed';
                tp2.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(createConfetti, 500);
                showToast('success', 'Order Placed!', 'Your WhatsApp order has been confirmed.');
            } else { showToast('info', 'Payment Required', 'Please scan the QR code and complete your payment.'); }
            try {
                var result = await supabaseClient.from('orders').select('*').eq('order_id', currentOrderId).single();
                if (result.error) { console.error('Error fetching order:', result.error); } else if (result.data) { updateUI(result.data); }
            } catch (err) { console.error('Error fetching order:', err); }
        });
        document.getElementById('confirmPayment').addEventListener('click', async function() {
            if (!currentOrderId) return;
            try {
                var upd = await supabaseClient.from('orders').update({ status: 'confirmed', payment: 'Paid' }).eq('order_id', currentOrderId).select();
                if (upd.error) { console.error('Error updating order:', upd.error); showToast('error', 'Error', 'Error confirming payment. Please try again.'); return; }
                document.getElementById('actionButtons').classList.add('hidden');
                document.getElementById('confirmationMessage').classList.remove('hidden');
                document.getElementById('statusBadge').innerHTML = '<i class="fas fa-check-circle"></i> <span>Payment Confirmed</span>';
                document.getElementById('statusBadge').className = 'status-badge confirmed';
                var tp3 = document.getElementById('timelineProcessing').querySelector('.timeline-icon');
                tp3.className = 'timeline-icon completed';
                tp3.innerHTML = '<i class="fas fa-check"></i>';
                createConfetti();
                showToast('success', 'Payment Confirmed!', 'Thank you! Your order is now being processed.');
                localStorage.removeItem('lastOrderId');
                localStorage.removeItem('paymentMethod');
            } catch (err) { console.error('Error confirming payment:', err); showToast('error', 'Error', 'Error confirming payment. Please try again.'); }
        });
        function updateUI(order) {
            if (order.status === 'confirmed') {
                document.getElementById('actionButtons').classList.add('hidden');
                document.getElementById('confirmationMessage').classList.remove('hidden');
                document.getElementById('statusBadge').innerHTML = '<i class="fas fa-check-circle"></i> <span>Payment Confirmed</span>';
                document.getElementById('statusBadge').className = 'status-badge confirmed';
                var tp4 = document.getElementById('timelineProcessing').querySelector('.timeline-icon');
                tp4.className = 'timeline-icon completed';
                tp4.innerHTML = '<i class="fas fa-check"></i>';
            }
        }
    </script>
</body>
</html>
